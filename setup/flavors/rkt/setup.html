{% import "macros.html" as macros %}

{% call macros.panel("info", "Step 1 - Download your configuration files") %}
<p>Docker Compose expects a project file, named <code>docker-compose.yml</code>
in a project directory. First create your project directory.</p>

<pre><code>mkdir {{ root }}
</pre></code>

<p>Then download the project file. A side configuration file makes it easier
to read and check the configuration variables generated by the wizard.</p>

<pre><code>cd {{ root }}
curl {{ url_for('.file', uid=uid, filepath='mailu.env', _external=True) }} > mailu.env
curl {{ url_for('.file', uid=uid, filepath='setup-postmaster.sh', _external=True) }} > setup-postmaster.sh
curl {{ url_for('.file', uid=uid, filepath='mailu-admin.service', _external=True) }} > mailu-admin.service
curl {{ url_for('.file', uid=uid, filepath='mailu-antispam.service', _external=True) }} > mailu-antispam.service
{% if antivirus_enabled %}
curl {{ url_for('.file', uid=uid, filepath='mailu-antivirus.service', _external=True) }} > mailu-antivirus.service
{% endif %}
{% if fetchmail_enabled %}
curl {{ url_for('.file', uid=uid, filepath='mailu-fetchmail.service', _external=True) }} > mailu-fetchmail.service
{% endif %}
curl {{ url_for('.file', uid=uid, filepath='mailu-front.service', _external=True) }} > mailu-front.service
curl {{ url_for('.file', uid=uid, filepath='mailu-imap.service', _external=True) }} > mailu-imap.service
curl {{ url_for('.file', uid=uid, filepath='mailu-redis.service', _external=True) }} > mailu-redis.service
{% if resolver_enabled %}
curl {{ url_for('.file', uid=uid, filepath='mailu-resolver.service', _external=True) }} > mailu-resolver.service
{% endif %}
curl {{ url_for('.file', uid=uid, filepath='mailu-smtp.service', _external=True) }} > mailu-smtp.service
{% if webdav_enabled %}
curl {{ url_for('.file', uid=uid, filepath='mailu-webdav.service', _external=True) }} > mailu-webdav.service
{% endif %}
{% if webmail_type != 'none' %}
curl {{ url_for('.file', uid=uid, filepath='mailu-webmail.service', _external=True) }} > mailu-webmail.service
{% endif %}
</pre></code>
{% endcall %}


{% call macros.panel("info", "Step 2 - Review the configuration") %}
<p>We did not insert any malicious code on purpose in the configurations we
distribute, but your download could have been intercepted, or our wizard
website could have been compromised, so make sure you check the configuration
files before going any further.</p>

<p>When you are done checking them, check them one last time.</p>
{% endcall %}

{% call macros.panel("info", "Step 3 - Start the Compose project") %}
<p>To start your compose project, simply run and enable downloaded systemd files <code>
chmod +x mailu-*.service
systemctl start mailu-*.service
systemctl enable mailu-*.service
</code>
</p>

<pre><code>cd {{ root }}
docker-compose -p mailu up -d
</pre></code>

Before you can use Mailu, you must create the primary administrator user account. This should be {{ postmaster }}@{{ domain }}. Use the following command, changing PASSWORD to your liking:

<pre><code>docker-compose -p mailu exec admin python manage.py admin {{ postmaster }} {{ domain }} PASSWORD
</pre></code>

<p>Login to the admin interface to change the password for a safe one, at
{% if admin_enabled %}
one of the hostnames 
<a href="https://{{ hostnames.split(',')[0] }}{{ admin_path }}">{{ hostnames.split(',')[0] }}{{ admin_path }}</a>.
{% else %}
<a href="http://127.0.0.1:8080">http://127.0.0.1:8080</a> (only directly from the host running docker).
{% endif %}
And choose the "Update password" option in the left menu.
</p>
{% endcall %}
